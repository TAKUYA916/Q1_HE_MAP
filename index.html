<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Q1 HE Keymap Editor</title>

<style>
body{
    background:#1a1a2e;
    color:#eee;
    font-family:sans-serif;
    padding:20px;
}

h1{
    text-align:center;
    color:#00d4ff;
}

/* ===== レイヤータブ ===== */
.layer-tabs{
    text-align:center;
    margin-bottom:20px;
}
.layer-tab{
    padding:8px 16px;
    margin:4px;
    background:#333;
    border:none;
    color:white;
    border-radius:6px;
    cursor:pointer;
}
.layer-tab.active{
    background:#00d4ff;
    color:black;
}

/* ===== キーボード描画（absolute方式 ⭐重要） ===== */
.keyboard{
    position:relative;
    width:900px;
    height:350px;
    margin:auto;
    background:#2d2d44;
    border-radius:12px;
}

.key{
    position:absolute;
    height:50px;
    background:#3a3a50;
    border:1px solid #555;
    border-radius:6px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:11px;
    cursor:pointer;
}

.key:hover{
    background:#4a4a60;
}

.key.selected{
    background:#00d4ff;
    color:black;
}

.transparent{ opacity:.4; }
.modifier{ background:#4a3a50; }
.layer-key{ background:#2f5a5a; }

/* ===== エディタ ===== */
.editor{
    max-width:500px;
    margin:30px auto;
}
input{
    width:100%;
    padding:8px;
    margin-top:6px;
}
button{
    padding:8px 12px;
    margin-top:8px;
}
</style>
</head>
<body>

<h1>⌨️ Keychron Q1 HE Keymap Editor</h1>

<div class="layer-tabs" id="tabs"></div>

<div class="keyboard" id="keyboard"></div>

<div class="editor" id="editor" style="display:none;">
    <input id="keyInput"/>
    <button onclick="applyKey()">適用</button>
</div>

<script>
/* ===============================
   ⭐ QMK keyboard.json（あなたの貼った内容）
   =============================== */
const QMK_JSON = {
"layouts":{"LAYOUT_ansi_82":{"layout":[
{"matrix":[0,0],"x":0,"y":0},
{"matrix":[0,1],"x":1.25,"y":0},
{"matrix":[0,2],"x":2.25,"y":0},
{"matrix":[0,3],"x":3.25,"y":0},
{"matrix":[0,4],"x":4.25,"y":0},
{"matrix":[0,5],"x":5.5,"y":0},
{"matrix":[0,6],"x":6.5,"y":0},
{"matrix":[0,7],"x":7.5,"y":0},
{"matrix":[0,8],"x":8.5,"y":0},
{"matrix":[0,9],"x":9.75,"y":0},
{"matrix":[0,10],"x":10.75,"y":0},
{"matrix":[0,11],"x":11.75,"y":0},
{"matrix":[0,12],"x":12.75,"y":0},
{"matrix":[0,13],"x":14,"y":0},
{"matrix":[0,14],"x":15.25,"y":0},

{"matrix":[1,0],"x":0,"y":1.25},
{"matrix":[1,1],"x":1,"y":1.25},
{"matrix":[1,2],"x":2,"y":1.25},
{"matrix":[1,3],"x":3,"y":1.25},
{"matrix":[1,4],"x":4,"y":1.25},
{"matrix":[1,5],"x":5,"y":1.25},
{"matrix":[1,6],"x":6,"y":1.25},
{"matrix":[1,7],"x":7,"y":1.25},
{"matrix":[1,8],"x":8,"y":1.25},
{"matrix":[1,9],"x":9,"y":1.25},
{"matrix":[1,10],"x":10,"y":1.25},
{"matrix":[1,11],"x":11,"y":1.25},
{"matrix":[1,12],"x":12,"y":1.25},
{"matrix":[1,13],"x":13,"y":1.25,"w":2},
{"matrix":[1,14],"x":15.25,"y":1.25},

{"matrix":[2,0],"x":0,"y":2.25,"w":1.5},
{"matrix":[2,1],"x":1.5,"y":2.25},
{"matrix":[2,2],"x":2.5,"y":2.25},
{"matrix":[2,3],"x":3.5,"y":2.25},
{"matrix":[2,4],"x":4.5,"y":2.25},
{"matrix":[2,5],"x":5.5,"y":2.25},
{"matrix":[2,6],"x":6.5,"y":2.25},
{"matrix":[2,7],"x":7.5,"y":2.25},
{"matrix":[2,8],"x":8.5,"y":2.25},
{"matrix":[2,9],"x":9.5,"y":2.25},
{"matrix":[2,10],"x":10.5,"y":2.25},
{"matrix":[2,11],"x":11.5,"y":2.25},
{"matrix":[2,12],"x":12.5,"y":2.25},
{"matrix":[2,13],"x":13.5,"y":2.25,"w":1.5},
{"matrix":[2,14],"x":15.25,"y":2.25},

{"matrix":[3,0],"x":0,"y":3.25,"w":1.75},
{"matrix":[3,1],"x":1.75,"y":3.25},
{"matrix":[3,2],"x":2.75,"y":3.25},
{"matrix":[3,3],"x":3.75,"y":3.25},
{"matrix":[3,4],"x":4.75,"y":3.25},
{"matrix":[3,5],"x":5.75,"y":3.25},
{"matrix":[3,6],"x":6.75,"y":3.25},
{"matrix":[3,7],"x":7.75,"y":3.25},
{"matrix":[3,8],"x":8.75,"y":3.25},
{"matrix":[3,9],"x":9.75,"y":3.25},
{"matrix":[3,10],"x":10.75,"y":3.25},
{"matrix":[3,11],"x":11.75,"y":3.25},
{"matrix":[3,12],"x":12.75,"y":3.25,"w":2.25},
{"matrix":[3,13],"x":15.25,"y":3.25},

{"matrix":[4,0],"x":0,"y":4.25,"w":2.25},
{"matrix":[4,2],"x":2.25,"y":4.25},
{"matrix":[4,3],"x":3.25,"y":4.25},
{"matrix":[4,4],"x":4.25,"y":4.25},
{"matrix":[4,5],"x":5.25,"y":4.25},
{"matrix":[4,6],"x":6.25,"y":4.25},
{"matrix":[4,7],"x":7.25,"y":4.25},
{"matrix":[4,8],"x":8.25,"y":4.25},
{"matrix":[4,9],"x":9.25,"y":4.25},
{"matrix":[4,10],"x":10.25,"y":4.25},
{"matrix":[4,12],"x":11.25,"y":4.25},
{"matrix":[4,13],"x":12.25,"y":4.25,"w":1.75},
{"matrix":[4,14],"x":14.25,"y":4.5},

{"matrix":[5,0],"x":0,"y":5.25,"w":1.25},
{"matrix":[5,1],"x":1.25,"y":5.25,"w":1.25},
{"matrix":[5,2],"x":2.5,"y":5.25,"w":1.25},
{"matrix":[5,6],"x":3.75,"y":5.25,"w":6.25},
{"matrix":[5,9],"x":10,"y":5.25},
{"matrix":[5,10],"x":11,"y":5.25},
{"matrix":[5,11],"x":12,"y":5.25},
{"matrix":[5,12],"x":13.25,"y":5.5},
{"matrix":[5,13],"x":14.25,"y":5.5},
{"matrix":[5,14],"x":15.25,"y":5.5}
]}}
};

/* ===== レイアウト生成 ===== */
const KEY_SIZE = 50;

const LAYOUT =
QMK_JSON.layouts.LAYOUT_ansi_82.layout.map(k=>({
    id:`k${k.matrix[0]}_${k.matrix[1]}`,
    x:k.x,
    y:k.y,
    w:k.w||1
}));

/* ===== レイヤー ===== */
let layers=[{name:"Base",keys:{}}];
let currentLayer=0;
let selected=null;

/* ===== 描画 ===== */
function renderTabs(){
    const t=document.getElementById("tabs");
    t.innerHTML=layers.map((l,i)=>
        `<button class="layer-tab ${i===currentLayer?"active":""}" onclick="switchLayer(${i})">${l.name}</button>`
    ).join("");
}

function renderKeyboard(){
    const kb=document.getElementById("keyboard");

    kb.innerHTML=LAYOUT.map(k=>{
        const kc=layers[currentLayer].keys[k.id]||"KC_TRNS";

        return `
        <div class="key ${kc==='KC_TRNS'?'transparent':''} ${selected===k.id?'selected':''}"
        style="
            left:${k.x*KEY_SIZE}px;
            top:${k.y*KEY_SIZE}px;
            width:${k.w*KEY_SIZE}px;
        "
        onclick="selectKey('${k.id}')">${kc.replace('KC_','')}</div>`;
    }).join("");
}

function selectKey(id){
    selected=id;
    document.getElementById("editor").style.display="block";
    document.getElementById("keyInput").value=layers[currentLayer].keys[id]||"KC_TRNS";
    renderKeyboard();
}

function applyKey(){
    layers[currentLayer].keys[selected]=document.getElementById("keyInput").value;
    renderKeyboard();
}

function switchLayer(i){
    currentLayer=i;
    renderTabs();
    renderKeyboard();
}

/* 初期化 */
renderTabs();
renderKeyboard();
</script>
</body>
</html>
